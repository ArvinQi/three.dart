        <!DOCTYPE html>
        <html>
        <head>
                <meta charset="utf-8">
        <title>Ray class / three Library / Dart Documentation</title>
        <link rel="stylesheet" type="text/css"
            href="../styles.css">
        <link href="//fonts.googleapis.com/css?family=Open+Sans:400,600,700,800" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" href="../favicon.ico">
        
        </head>
        <body data-library="three" data-type="Ray">
        <div class="page">
        <div class="header">
          <a href="../index.html"><div class="logo"></div></a>
          <a href="../index.html">Dart Documentation</a>
         &rsaquo; <a href="../three.html">three</a> &rsaquo; <a href="../three/Ray.html">Ray</a>        <div id="search-box">
          <input type="search" name="q" id="q" autocomplete="off"
              class="search-input" placeholder="Search API">
        </div>
        
      </div>
      <div class="drop-down" id="drop-down"></div>
      
        <div class="nav">
        
<h2><div class="icon-library"></div><a href="../CurveUtils.html">CurveUtils</a></h2><h2><div class="icon-library"></div><a href="../FirstPersonControls.html">FirstPersonControls</a></h2><h2><div class="icon-library"></div><a href="../FontUtils.html">FontUtils</a></h2><h2><div class="icon-library"></div><a href="../GeometryUtils.html">GeometryUtils</a></h2><h2><div class="icon-library"></div><a href="../ImageUtils.html">ImageUtils</a></h2><h2><div class="icon-library"></div><a href="../SceneUtils.html">SceneUtils</a></h2><h2><div class="icon-library"></div><a href="../ShaderUtils.html">ShaderUtils</a></h2><h2><div class="icon-library"></div><a href="../ShapeUtils.html">ShapeUtils</a></h2><h2><div class="icon-library"></div><a href="../three.html">three</a></h2><ul class="icon">
<li><a href="../three/AmbientLight.html"><div class="icon-class"></div>AmbientLight</a></li>
<li><a href="../three/ArcCurve.html"><div class="icon-class"></div>ArcCurve</a></li>
<li><a href="../three/ArrowHelper.html"><div class="icon-class"></div>ArrowHelper</a></li>
<li><a href="../three/Attribute.html"><div class="icon-class"></div>Attribute&lt;T&gt;</a></li>
<li><a href="../three/AxisHelper.html"><div class="icon-class"></div>AxisHelper</a></li>
<li><a href="../three/Bone.html"><div class="icon-class"></div>Bone</a></li>
<li><a href="../three/BoundingBox.html"><div class="icon-class"></div>BoundingBox</a></li>
<li><a href="../three/BoundingSphere.html"><div class="icon-class"></div>BoundingSphere</a></li>
<li><a href="../three/Buffer.html"><div class="icon-class"></div>Buffer</a></li>
<li><a href="../three/BufferGeometry.html"><div class="icon-class"></div>BufferGeometry</a></li>
<li><a href="../three/Camera.html"><div class="icon-class"></div>Camera</a></li>
<li><a href="../three/CameraHelper.html"><div class="icon-class"></div>CameraHelper</a></li>
<li><a href="../three/CanvasRenderData.html"><div class="icon-class"></div>CanvasRenderData</a></li>
<li><a href="../three/CanvasRenderer.html"><div class="icon-class"></div>CanvasRenderer</a></li>
<li><a href="../three/Chunk.html"><div class="icon-class"></div>Chunk</a></li>
<li><a href="../three/CircleGeometry.html"><div class="icon-class"></div>CircleGeometry</a></li>
<li><a href="../three/ClosedSplineCurve3.html"><div class="icon-class"></div>ClosedSplineCurve3</a></li>
<li><a href="../three/Color.html"><div class="icon-class"></div>Color</a></li>
<li><a href="../three/CompressedTexture.html"><div class="icon-class"></div>CompressedTexture</a></li>
<li><a href="../three/ConvexGeometry.html"><div class="icon-class"></div>ConvexGeometry</a></li>
<li><a href="../three/CSS3DObject.html"><div class="icon-class"></div>CSS3DObject</a></li>
<li><a href="../three/CSS3DRenderer.html"><div class="icon-class"></div>CSS3DRenderer</a></li>
<li><a href="../three/CubeGeometry.html"><div class="icon-class"></div>CubeGeometry</a></li>
<li><a href="../three/CubeGeomSides.html"><div class="icon-class"></div>CubeGeomSides</a></li>
<li><a href="../three/CubeReflectionMapping.html"><div class="icon-class"></div>CubeReflectionMapping</a></li>
<li><a href="../three/CubeRefractionMapping.html"><div class="icon-class"></div>CubeRefractionMapping</a></li>
<li><a href="../three/CubicBezierCurve.html"><div class="icon-class"></div>CubicBezierCurve</a></li>
<li><a href="../three/CubicBezierCurve3.html"><div class="icon-class"></div>CubicBezierCurve3</a></li>
<li><a href="../three/Curve.html"><div class="icon-class"></div>Curve&lt;V&gt;</a></li>
<li><a href="../three/Curve2D.html"><div class="icon-class"></div>Curve2D</a></li>
<li><a href="../three/Curve3D.html"><div class="icon-class"></div>Curve3D</a></li>
<li><a href="../three/CurvePath.html"><div class="icon-class"></div>CurvePath</a></li>
<li><a href="../three/CylinderGeometry.html"><div class="icon-class"></div>CylinderGeometry</a></li>
<li><a href="../three/DataTexture.html"><div class="icon-class"></div>DataTexture</a></li>
<li><a href="../three/DirectionalLight.html"><div class="icon-class"></div>DirectionalLight</a></li>
<li><a href="../three/EllipseCurve.html"><div class="icon-class"></div>EllipseCurve</a></li>
<li><a href="../three/EventEmitter.html"><div class="icon-class"></div>EventEmitter</a></li>
<li><a href="../three/EventEmitterEvent.html"><div class="icon-class"></div>EventEmitterEvent</a></li>
<li><a href="../three/ExtrudeGeometry.html"><div class="icon-class"></div>ExtrudeGeometry</a></li>
<li><a href="../three/ExtrudeGeometryWorldUVGenerator.html"><div class="icon-class"></div>ExtrudeGeometryWorldUVGenerator</a></li>
<li><a href="../three/Face.html"><div class="icon-class"></div>Face</a></li>
<li><a href="../three/Face3.html"><div class="icon-class"></div>Face3</a></li>
<li><a href="../three/Face4.html"><div class="icon-class"></div>Face4</a></li>
<li><a href="../three/Fog.html"><div class="icon-class"></div>Fog</a></li>
<li><a href="../three/FogExp2.html"><div class="icon-class"></div>FogExp2</a></li>
<li><a href="../three/FogLinear.html"><div class="icon-class"></div>FogLinear</a></li>
<li><a href="../three/Frustum.html"><div class="icon-class"></div>Frustum</a></li>
<li><a href="../three/Geometry.html"><div class="icon-class"></div>Geometry</a></li>
<li><a href="../three/GeometryAttribute.html"><div class="icon-class"></div>GeometryAttribute&lt;T&gt;</a></li>
<li><a href="../three/Gyroscope.html"><div class="icon-class"></div>Gyroscope</a></li>
<li><a href="../three/HemisphereLight.html"><div class="icon-class"></div>HemisphereLight</a></li>
<li><a href="../three/IcosahedronGeometry.html"><div class="icon-class"></div>IcosahedronGeometry</a></li>
<li><a href="../three/ImageList.html"><div class="icon-class"></div>ImageList</a></li>
<li><a href="../three/ImageLoader.html"><div class="icon-class"></div>ImageLoader</a></li>
<li><a href="../three/IMaterial.html"><div class="icon-class"></div>IMaterial</a></li>
<li><a href="../three/ImmediateRenderObject.html"><div class="icon-class"></div>ImmediateRenderObject</a></li>
<li><a href="../three/Intersect.html"><div class="icon-class"></div>Intersect</a></li>
<li><a href="../three/IParticleMaterial.html"><div class="icon-class"></div>IParticleMaterial</a></li>
<li><a href="../three/IRenderable.html"><div class="icon-class"></div>IRenderable</a></li>
<li><a href="../three/ITextureMapMaterial.html"><div class="icon-class"></div>ITextureMapMaterial</a></li>
<li><a href="../three/JSONLoader.html"><div class="icon-class"></div>JSONLoader</a></li>
<li><a href="../three/LatheGeometry.html"><div class="icon-class"></div>LatheGeometry</a></li>
<li><a href="../three/LensFlare.html"><div class="icon-class"></div>LensFlare</a></li>
<li><a href="../three/Light.html"><div class="icon-class"></div>Light</a></li>
<li><a href="../three/Line.html"><div class="icon-class"></div>Line</a></li>
<li><a href="../three/LineBasicMaterial.html"><div class="icon-class"></div>LineBasicMaterial</a></li>
<li><a href="../three/LineCurve.html"><div class="icon-class"></div>LineCurve</a></li>
<li><a href="../three/LineCurve3.html"><div class="icon-class"></div>LineCurve3</a></li>
<li><a href="../three/LoadCompleteCallback.html"><div class="icon-interface"></div>LoadCompleteCallback</a></li>
<li><a href="../three/LoadedCallback.html"><div class="icon-interface"></div>LoadedCallback</a></li>
<li><a href="../three/Loader.html"><div class="icon-class"></div>Loader</a></li>
<li><a href="../three/LoadProgressCallback.html"><div class="icon-interface"></div>LoadProgressCallback</a></li>
<li><a href="../three/LoadStartCallback.html"><div class="icon-interface"></div>LoadStartCallback</a></li>
<li><a href="../three/LOD.html"><div class="icon-class"></div>LOD</a></li>
<li><a href="../three/Material.html"><div class="icon-class"></div>Material</a></li>
<li><a href="../three/Mesh.html"><div class="icon-class"></div>Mesh</a></li>
<li><a href="../three/MeshBasicMaterial.html"><div class="icon-class"></div>MeshBasicMaterial</a></li>
<li><a href="../three/MeshDepthMaterial.html"><div class="icon-class"></div>MeshDepthMaterial</a></li>
<li><a href="../three/MeshFaceMaterial.html"><div class="icon-class"></div>MeshFaceMaterial</a></li>
<li><a href="../three/MeshLambertMaterial.html"><div class="icon-class"></div>MeshLambertMaterial</a></li>
<li><a href="../three/MeshNormalMaterial.html"><div class="icon-class"></div>MeshNormalMaterial</a></li>
<li><a href="../three/MeshPhongMaterial.html"><div class="icon-class"></div>MeshPhongMaterial</a></li>
<li><a href="../three/MorphAnimMesh.html"><div class="icon-class"></div>MorphAnimMesh</a></li>
<li><a href="../three/MorphColors.html"><div class="icon-class"></div>MorphColors</a></li>
<li><a href="../three/MorphTarget.html"><div class="icon-class"></div>MorphTarget</a></li>
<li><a href="../three/Object3D.html"><div class="icon-class"></div>Object3D</a></li>
<li><a href="../three/OctahedronGeometry.html"><div class="icon-class"></div>OctahedronGeometry</a></li>
<li><a href="../three/OrthographicCamera.html"><div class="icon-class"></div>OrthographicCamera</a></li>
<li><a href="../three/ParametricGeometry.html"><div class="icon-class"></div>ParametricGeometry</a></li>
<li><a href="../three/Particle.html"><div class="icon-class"></div>Particle</a></li>
<li><a href="../three/ParticleBasicMaterial.html"><div class="icon-class"></div>ParticleBasicMaterial</a></li>
<li><a href="../three/ParticleCanvasMaterial.html"><div class="icon-class"></div>ParticleCanvasMaterial</a></li>
<li><a href="../three/ParticleCanvasMaterialProgram.html"><div class="icon-interface"></div>ParticleCanvasMaterialProgram</a></li>
<li><a href="../three/ParticleSystem.html"><div class="icon-class"></div>ParticleSystem</a></li>
<li><a href="../three/Path.html"><div class="icon-class"></div>Path</a></li>
<li><a href="../three/PathAction.html"><div class="icon-class"></div>PathAction</a></li>
<li><a href="../three/PerspectiveCamera.html"><div class="icon-class"></div>PerspectiveCamera</a></li>
<li><a href="../three/PlaneGeometry.html"><div class="icon-class"></div>PlaneGeometry</a></li>
<li><a href="../three/PointLight.html"><div class="icon-class"></div>PointLight</a></li>
<li><a href="../three/PolyhedronGeometry.html"><div class="icon-class"></div>PolyhedronGeometry</a></li>
<li><a href="../three/PolyhedronGeometryVertex.html"><div class="icon-class"></div>PolyhedronGeometryVertex</a></li>
<li><a href="../three/Program.html"><div class="icon-class"></div>Program</a></li>
<li><a href="../three/Projector.html"><div class="icon-class"></div>Projector</a></li>
<li><a href="../three/ProjectorRenderData.html"><div class="icon-class"></div>ProjectorRenderData</a></li>
<li><a href="../three/QuadraticBezierCurve.html"><div class="icon-class"></div>QuadraticBezierCurve</a></li>
<li><a href="../three/QuadraticBezierCurve3.html"><div class="icon-class"></div>QuadraticBezierCurve3</a></li>
<li><div class="icon-class"></div><strong>Ray</strong></li>
<li><a href="../three/Rectangle.html"><div class="icon-class"></div>Rectangle</a></li>
<li><a href="../three/RenderableFace.html"><div class="icon-class"></div>RenderableFace</a></li>
<li><a href="../three/RenderableFace3.html"><div class="icon-class"></div>RenderableFace3</a></li>
<li><a href="../three/RenderableFace4.html"><div class="icon-class"></div>RenderableFace4</a></li>
<li><a href="../three/RenderableLine.html"><div class="icon-class"></div>RenderableLine</a></li>
<li><a href="../three/RenderableObject.html"><div class="icon-class"></div>RenderableObject</a></li>
<li><a href="../three/RenderableParticle.html"><div class="icon-class"></div>RenderableParticle</a></li>
<li><a href="../three/RenderableVertex.html"><div class="icon-class"></div>RenderableVertex</a></li>
<li><a href="../three/Renderer.html"><div class="icon-class"></div>Renderer</a></li>
<li><a href="../three/RenderInts.html"><div class="icon-class"></div>RenderInts</a></li>
<li><a href="../three/Ribbon.html"><div class="icon-class"></div>Ribbon</a></li>
<li><a href="../three/Scene.html"><div class="icon-class"></div>Scene</a></li>
<li><a href="../three/ShaderMaterial.html"><div class="icon-class"></div>ShaderMaterial</a></li>
<li><a href="../three/ShadowCaster.html"><div class="icon-class"></div>ShadowCaster</a></li>
<li><a href="../three/ShadowMapPlugin.html"><div class="icon-class"></div>ShadowMapPlugin</a></li>
<li><a href="../three/Shape.html"><div class="icon-class"></div>Shape</a></li>
<li><a href="../three/ShapeGeometry.html"><div class="icon-class"></div>ShapeGeometry</a></li>
<li><a href="../three/SkinnedMesh.html"><div class="icon-class"></div>SkinnedMesh</a></li>
<li><a href="../three/SphereGeometry.html"><div class="icon-class"></div>SphereGeometry</a></li>
<li><a href="../three/SphericalReflectionMapping.html"><div class="icon-class"></div>SphericalReflectionMapping</a></li>
<li><a href="../three/SphericalRefractionMapping.html"><div class="icon-class"></div>SphericalRefractionMapping</a></li>
<li><a href="../three/SplineCurve.html"><div class="icon-class"></div>SplineCurve</a></li>
<li><a href="../three/SplineCurve3.html"><div class="icon-class"></div>SplineCurve3</a></li>
<li><a href="../three/SpotLight.html"><div class="icon-class"></div>SpotLight</a></li>
<li><a href="../three/Sprite.html"><div class="icon-class"></div>Sprite</a></li>
<li><a href="../three/SpriteAlignment.html"><div class="icon-class"></div>SpriteAlignment</a></li>
<li><a href="../three/TetrahedronGeometry.html"><div class="icon-class"></div>TetrahedronGeometry</a></li>
<li><a href="../three/TextGeometry.html"><div class="icon-class"></div>TextGeometry</a></li>
<li><a href="../three/Texture.html"><div class="icon-class"></div>Texture</a></li>
<li><a href="../three/TorusGeometry.html"><div class="icon-class"></div>TorusGeometry</a></li>
<li><a href="../three/TorusKnotGeometry.html"><div class="icon-class"></div>TorusKnotGeometry</a></li>
<li><a href="../three/TubeGeometry.html"><div class="icon-class"></div>TubeGeometry</a></li>
<li><a href="../three/Uniform.html"><div class="icon-class"></div>Uniform&lt;T&gt;</a></li>
<li><a href="../three/UniformsUtils.html"><div class="icon-class"></div>UniformsUtils</a></li>
<li><a href="../three/UV.html"><div class="icon-class"></div>UV</a></li>
<li><a href="../three/UVMapping.html"><div class="icon-class"></div>UVMapping</a></li>
<li><a href="../three/VirtualLight.html"><div class="icon-class"></div>VirtualLight</a></li>
<li><a href="../three/WebGLCamera.html"><div class="icon-class"></div>WebGLCamera</a></li>
<li><a href="../three/WebGLGeometry.html"><div class="icon-class"></div>WebGLGeometry</a></li>
<li><a href="../three/WebGLImageList.html"><div class="icon-class"></div>WebGLImageList</a></li>
<li><a href="../three/WebGLMaterial.html"><div class="icon-class"></div>WebGLMaterial</a></li>
<li><a href="../three/WebGLObject.html"><div class="icon-class"></div>WebGLObject</a></li>
<li><a href="../three/WebGLRenderer.html"><div class="icon-class"></div>WebGLRenderer</a></li>
<li><a href="../three/WebGLRendererInfo.html"><div class="icon-class"></div>WebGLRendererInfo</a></li>
<li><a href="../three/WebGLRendererMemoryInfo.html"><div class="icon-class"></div>WebGLRendererMemoryInfo</a></li>
<li><a href="../three/WebGLRendererRenderInfo.html"><div class="icon-class"></div>WebGLRendererRenderInfo</a></li>
<li><a href="../three/WebGLRenderTarget.html"><div class="icon-class"></div>WebGLRenderTarget</a></li>
<li><a href="../three/WebGLRenderTargetCube.html"><div class="icon-class"></div>WebGLRenderTargetCube</a></li>
</ul>
<h2><div class="icon-library"></div><a href="../ThreeMath.html">ThreeMath</a></h2><h2><div class="icon-library"></div><a href="../TrackballControls.html">TrackballControls</a></h2><h2><div class="icon-library"></div><a href="../tween.html">tween</a></h2><h2><div class="icon-library"></div><a href="../vector_math.html">vector_math</a></h2></div>
<div class="content">
        <h2><strong>Ray</strong>
          class
        </h2>
        
<button id="show-inherited" class="show-inherited">Hide inherited</button>
<div class="doc">
<p>@author mr.doob / http://mrdoob.com/</p>
<p>Ported to Dart from JS by:
@author rob silverton / http://www.unwrong.com/</p>
<pre class="source">
class Ray {
 Vector3 origin,
         direction;
 num near,
     far;

 final num precision;

 Ray( [this.origin, this.direction, this.near = 0, this.far = double.INFINITY] )
     : precision = 0.0001 {

   if (this.origin == null) this.origin = new Vector3.zero();
   if (this.direction == null) this.direction = new Vector3.zero();

     }

 double _distanceFromIntersection( Vector3 origin, Vector3 direction, Vector3 position ) {
   Vector3 v0 = position - origin;
   double dot = v0.dot(direction);

   Vector3 intersect = origin + direction.scaled(dot);
   double distance = position.absoluteError(intersect);

   return distance;
 }

 //http://www.blackpawn.com/texts/pointinpoly/default.html
 bool _pointInFace3( Vector3 p, Vector3 a, Vector3 b, Vector3 c ) {
   num dot00, dot01, dot02, dot11, dot12, invDenom, u, v;

   Vector3 v0 = c - a;
   Vector3 v1 = b - a;
   Vector3 v2 = p - a;

   dot00 = v0.dot( v0 );
   dot01 = v0.dot( v1 );
   dot02 = v0.dot( v2 );
   dot11 = v1.dot( v1 );
   dot12 = v1.dot( v2 );

   invDenom = 1 / ( dot00 * dot11 - dot01 * dot01 );
   u = ( dot11 * dot02 - dot01 * dot12 ) * invDenom;
   v = ( dot00 * dot12 - dot01 * dot02 ) * invDenom;

   return ( u &gt;= 0 ) &amp;&amp; ( v &gt;= 0 ) &amp;&amp; ( u + v &lt; 1 );
 }

 List&lt;Intersect&gt; intersectObject( Object3D object, {bool recursive: false} ) {
   List&lt;Vector3&gt; abcd = new List.generate(4, (_) =&gt; new Vector3.zero());

   Vector3 originCopy = new Vector3.zero();
   Vector3 directionCopy = new Vector3.zero();

   Vector3 vector = new Vector3.zero();
   Vector3 normal = new Vector3.zero();
   Vector3 intersectPoint = new Vector3.zero();

   Intersect intersect;
   List intersects = [];
   int l = object.children.length;

   if ( recursive ) {
     object.children.forEach((child) {
       intersects.addAll(intersectObject( child ));
     });
   }

   if ( object is Particle ) {
     num distance = _distanceFromIntersection( origin, direction, object.matrixWorld.getTranslation() );

     if ( distance &gt; object.scale.x ) {
       return [];
     }

     intersect = new Intersect(
         distance: distance,
         point: object.position,
         face: null,
         object: object);


     intersects.add( intersect );

   } else if ( object is Mesh ) {
     Mesh mesh = object;
     // Checking boundingSphere
     num distance = _distanceFromIntersection( origin, direction, object.matrixWorld.getTranslation() );
     Vector3 scale = Frustum.__v1.setValues( object.matrixWorld.getColumn(0).length, object.matrixWorld.getColumn(1).length, object.matrixWorld.getColumn(2).length );

     if ( distance &gt; mesh.geometry.boundingSphere.radius * Math.max( scale.x, Math.max( scale.y, scale.z ) ) ) {
       return intersects;
     }

     // Checking faces

     int f;

     Face face;
     num dot, scalar;
     Geometry geometry = mesh.geometry;
     List vertices = geometry.vertices;
     Matrix4 objMatrix;
     Material material;

     List&lt;Material&gt; geometryMaterials = object.geometry.materials;
     bool isFaceMaterial = object.material is MeshFaceMaterial;
     int side = object.material.side;


     extractRotation(object.matrixRotationWorld, object.matrixWorld);

     int fl = geometry.faces.length;

     for (var f = 0; f &lt; fl; f++) {

       face = geometry.faces[f];

       material = isFaceMaterial == true ? geometryMaterials[ face.materialIndex ] : object.material;
       if ( material == null ) continue;

       side = material.side;

       originCopy.setFrom( origin );
       directionCopy.setFrom( direction );

       objMatrix = object.matrixWorld;

       // determine if ray intersects the plane of the face
       // note: this works regardless of the direction of the face normal

       vector.setFrom(face.centroid);
       vector.applyProjection(objMatrix).sub(originCopy);
       normal.setFrom(face.normal);
       normal.applyProjection(object.matrixRotationWorld);
       dot = directionCopy.dot(normal);

       // bail if ray and plane are parallel
       if ( dot.abs() &lt; 0.0001 ) continue;

       // calc distance to plane

       scalar = normal.dot( vector ) / dot;

       // if negative distance, then plane is behind ray

       if ( scalar &lt; 0 ) continue;

       if ( side == DoubleSide || ( side == FrontSide ? dot &lt; 0 : dot &gt; 0 ) ) {

         intersectPoint = originCopy + directionCopy.scale(scalar);

         abcd = face.indices.map((idx) =&gt; vertices[idx].clone().applyProjection(objMatrix)).toList();

         var pointInFace;

         // TODO - Make this work a face of arbitrary size
         if ( face.size == 3) {

           pointInFace =  _pointInFace3( intersectPoint, abcd[0], abcd[1], abcd[2] );

         } else if ( face.size == 4 ) {

           pointInFace =
               _pointInFace3( intersectPoint, abcd[0], abcd[1], abcd[3]) ||
               _pointInFace3( intersectPoint, abcd[1], abcd[2], abcd[3] );

         }

         if ( pointInFace  ) {
           intersect = new Intersect(
               distance: originCopy.absoluteError( intersectPoint ),
               point: intersectPoint.clone(),
               face: face,
               object: object
           );

           intersects.add( intersect );
         }
       }
     }
   }

   return intersects;
 }

 List&lt;Intersect&gt; intersectObjects( List&lt;Object3D&gt; objects ) {
   int l = objects.length;
   List&lt;Intersect&gt; intersects = [];

   objects.forEach((o) =&gt; intersects.addAll(intersectObject(o)));

   intersects.sort( ( a, b ) =&gt; a.distance.compareTo(b.distance) );

   return intersects;
 }

}
</pre>
</div>
<div>
<h3>Constructors</h3>
<div class="method"><h4 id="">
<button class="show-code">Code</button>
new <strong>Ray</strong>([<a href="../vector_math/Vector3.html">Vector3</a> origin, <a href="../vector_math/Vector3.html">Vector3</a> direction, <a href="http://api.dartlang.org/dart_core/num.html">num</a> near = 0, <a href="http://api.dartlang.org/dart_core/num.html">num</a> far = double.INFINITY]) <a class="anchor-link" href="#"
              title="Permalink to Ray.Ray">#</a></h4>
<div class="doc">
<div class="inherited">
<p>Creates a new <a class="crossref" href="../dart_core/Object.html">Object</a> instance.</p>
<p><a class="crossref" href="../dart_core/Object.html">Object</a> instances have no meaningful state, and are only useful
through their identity. An <a class="crossref" href="../dart_core/Object.html">Object</a> instance is equal to itself
only.</p>
<div class="docs-inherited-from">docs inherited from <a href="http://api.dartlang.org/dart_core/Object.html">Object</a> </div></div>
<pre class="source">
Ray( [this.origin, this.direction, this.near = 0, this.far = double.INFINITY] )
   : precision = 0.0001 {

 if (this.origin == null) this.origin = new Vector3.zero();
 if (this.direction == null) this.direction = new Vector3.zero();

   }
</pre>
</div>
</div>
</div>
<div>
<h3>Properties</h3>
<div class="field"><h4 id="direction">
<button class="show-code">Code</button>
<a href="../vector_math/Vector3.html">Vector3</a>         <strong>direction</strong> <a class="anchor-link"
            href="#direction"
            title="Permalink to Ray.direction">#</a>
        </h4>
        <div class="doc">
<pre class="source">
Vector3 origin,
       direction
</pre>
</div>
</div>
<div class="field"><h4 id="far">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/num.html">num</a>         <strong>far</strong> <a class="anchor-link"
            href="#far"
            title="Permalink to Ray.far">#</a>
        </h4>
        <div class="doc">
<pre class="source">
num near,
   far
</pre>
</div>
</div>
<div class="field"><h4 id="near">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/num.html">num</a>         <strong>near</strong> <a class="anchor-link"
            href="#near"
            title="Permalink to Ray.near">#</a>
        </h4>
        <div class="doc">
<pre class="source">
num near
</pre>
</div>
</div>
<div class="field"><h4 id="origin">
<button class="show-code">Code</button>
<a href="../vector_math/Vector3.html">Vector3</a>         <strong>origin</strong> <a class="anchor-link"
            href="#origin"
            title="Permalink to Ray.origin">#</a>
        </h4>
        <div class="doc">
<pre class="source">
Vector3 origin
</pre>
</div>
</div>
<div class="field"><h4 id="precision">
<button class="show-code">Code</button>
final <a href="http://api.dartlang.org/dart_core/num.html">num</a>         <strong>precision</strong> <a class="anchor-link"
            href="#precision"
            title="Permalink to Ray.precision">#</a>
        </h4>
        <div class="doc">
<pre class="source">
final num precision
</pre>
</div>
</div>
</div>
<div>
<h3>Methods</h3>
<div class="method"><h4 id="intersectObject">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/List.html">List</a>&lt;<a href="../three/Intersect.html">Intersect</a>&gt; <strong>intersectObject</strong>(<a href="../three/Object3D.html">Object3D</a> object, {<a href="http://api.dartlang.org/dart_core/bool.html">bool</a> recursive: false}) <a class="anchor-link" href="#intersectObject"
              title="Permalink to Ray.intersectObject">#</a></h4>
<div class="doc">
<pre class="source">
List&lt;Intersect&gt; intersectObject( Object3D object, {bool recursive: false} ) {
 List&lt;Vector3&gt; abcd = new List.generate(4, (_) =&gt; new Vector3.zero());

 Vector3 originCopy = new Vector3.zero();
 Vector3 directionCopy = new Vector3.zero();

 Vector3 vector = new Vector3.zero();
 Vector3 normal = new Vector3.zero();
 Vector3 intersectPoint = new Vector3.zero();

 Intersect intersect;
 List intersects = [];
 int l = object.children.length;

 if ( recursive ) {
   object.children.forEach((child) {
     intersects.addAll(intersectObject( child ));
   });
 }

 if ( object is Particle ) {
   num distance = _distanceFromIntersection( origin, direction, object.matrixWorld.getTranslation() );

   if ( distance &gt; object.scale.x ) {
     return [];
   }

   intersect = new Intersect(
       distance: distance,
       point: object.position,
       face: null,
       object: object);


   intersects.add( intersect );

 } else if ( object is Mesh ) {
   Mesh mesh = object;
   // Checking boundingSphere
   num distance = _distanceFromIntersection( origin, direction, object.matrixWorld.getTranslation() );
   Vector3 scale = Frustum.__v1.setValues( object.matrixWorld.getColumn(0).length, object.matrixWorld.getColumn(1).length, object.matrixWorld.getColumn(2).length );

   if ( distance &gt; mesh.geometry.boundingSphere.radius * Math.max( scale.x, Math.max( scale.y, scale.z ) ) ) {
     return intersects;
   }

   // Checking faces

   int f;

   Face face;
   num dot, scalar;
   Geometry geometry = mesh.geometry;
   List vertices = geometry.vertices;
   Matrix4 objMatrix;
   Material material;

   List&lt;Material&gt; geometryMaterials = object.geometry.materials;
   bool isFaceMaterial = object.material is MeshFaceMaterial;
   int side = object.material.side;


   extractRotation(object.matrixRotationWorld, object.matrixWorld);

   int fl = geometry.faces.length;

   for (var f = 0; f &lt; fl; f++) {

     face = geometry.faces[f];

     material = isFaceMaterial == true ? geometryMaterials[ face.materialIndex ] : object.material;
     if ( material == null ) continue;

     side = material.side;

     originCopy.setFrom( origin );
     directionCopy.setFrom( direction );

     objMatrix = object.matrixWorld;

     // determine if ray intersects the plane of the face
     // note: this works regardless of the direction of the face normal

     vector.setFrom(face.centroid);
     vector.applyProjection(objMatrix).sub(originCopy);
     normal.setFrom(face.normal);
     normal.applyProjection(object.matrixRotationWorld);
     dot = directionCopy.dot(normal);

     // bail if ray and plane are parallel
     if ( dot.abs() &lt; 0.0001 ) continue;

     // calc distance to plane

     scalar = normal.dot( vector ) / dot;

     // if negative distance, then plane is behind ray

     if ( scalar &lt; 0 ) continue;

     if ( side == DoubleSide || ( side == FrontSide ? dot &lt; 0 : dot &gt; 0 ) ) {

       intersectPoint = originCopy + directionCopy.scale(scalar);

       abcd = face.indices.map((idx) =&gt; vertices[idx].clone().applyProjection(objMatrix)).toList();

       var pointInFace;

       // TODO - Make this work a face of arbitrary size
       if ( face.size == 3) {

         pointInFace =  _pointInFace3( intersectPoint, abcd[0], abcd[1], abcd[2] );

       } else if ( face.size == 4 ) {

         pointInFace =
             _pointInFace3( intersectPoint, abcd[0], abcd[1], abcd[3]) ||
             _pointInFace3( intersectPoint, abcd[1], abcd[2], abcd[3] );

       }

       if ( pointInFace  ) {
         intersect = new Intersect(
             distance: originCopy.absoluteError( intersectPoint ),
             point: intersectPoint.clone(),
             face: face,
             object: object
         );

         intersects.add( intersect );
       }
     }
   }
 }

 return intersects;
}
</pre>
</div>
</div>
<div class="method"><h4 id="intersectObjects">
<button class="show-code">Code</button>
<a href="http://api.dartlang.org/dart_core/List.html">List</a>&lt;<a href="../three/Intersect.html">Intersect</a>&gt; <strong>intersectObjects</strong>(<a href="http://api.dartlang.org/dart_core/List.html">List</a>&lt;<a href="../three/Object3D.html">Object3D</a>&gt; objects) <a class="anchor-link" href="#intersectObjects"
              title="Permalink to Ray.intersectObjects">#</a></h4>
<div class="doc">
<pre class="source">
List&lt;Intersect&gt; intersectObjects( List&lt;Object3D&gt; objects ) {
 int l = objects.length;
 List&lt;Intersect&gt; intersects = [];

 objects.forEach((o) =&gt; intersects.addAll(intersectObject(o)));

 intersects.sort( ( a, b ) =&gt; a.distance.compareTo(b.distance) );

 return intersects;
}
</pre>
</div>
</div>
</div>
        </div>
        <div class="clear"></div>
        </div>
        <div class="footer">
          <div>This page was generated at 2013-11-08 17:35:34.077</div>
        </div>
        <script async src="../client-static.js"></script>
        </body></html>
        
